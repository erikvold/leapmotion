<html>
    <head>
        <title>Main Menu</title>
        <style>
            p b     { color:#FFF; }
            canvas  { position:fixed; top:0px; left:0px; z-index:-1; }
            div     { color:#FFF; }
        </style>
    </head>
    <body>
        <div id="container">
            <h1>Main Menu</h1>
            <div id="hands">2</div>
            <div id="pointables">0</div>
            <div id="x">0</div>
            <div id="y">0</div>
            <div id="z">0</div>
            <div id="gestures"></div>
            <div id="rotate_y"></div>
            </p>
        </div>

        <script src="lib/three.min.r63.js"></script>
        <script src="lib/leap.min.321b71394.js"></script>
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script>
            // Watch for gestures
            var ctl = new Leap.Controller({enableGestures: true});
            ctl.connect();

            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

            container = document.getElementById("container");

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            var wood =  THREE.ImageUtils.loadTexture( 'textures/crate.gif' );
            var side1 = THREE.ImageUtils.loadTexture( 'textures/1.jpg' );
            var side2 = THREE.ImageUtils.loadTexture( 'textures/2.jpg' );
            var side3 = THREE.ImageUtils.loadTexture( 'textures/3.jpg' );

            materials = [
                new THREE.MeshBasicMaterial( { map: side1 } ),
                new THREE.MeshBasicMaterial( { map: side3 } ),
                new THREE.MeshBasicMaterial( { map: wood  } ),
                new THREE.MeshBasicMaterial( { map: wood  } ),
                new THREE.MeshBasicMaterial( { map: wood  } ),
                new THREE.MeshBasicMaterial( { map: side2 } )
            ];

            var cubeGeo = new THREE.CubeGeometry( 3, 3, 3, 1, 1, 1 );
            var cube = new THREE.Mesh( cubeGeo, new THREE.MeshFaceMaterial( materials ));
            cube.rotation.y = Math.PI;   // radians. PI = 180 degrees
            scene.add( cube );

            camera.position.z = 5;

            var debug_only_one = 0;
            var rotate_y = 0;
            Leap.loop(function(frame) {
                // Handle swipes
                frame.gestures.forEach(function(gesture,i) {
                    if (gesture.state == "stop") {

                        // Debug info into the DOM
                        var id = "gesture_" + gesture.id;
                        $("#gestures").append("<span id='" + id + "'>" + gesture.type + " </span>");
                        $("#" + id).fadeOut(400, function() {
                            this.remove();
                        });

                        if (gesture.type != "swipe") return;
                        if (gesture.direction[0] > 0) {
                            rotate_y += Math.PI / 2;
                        } else {
                            rotate_y -= Math.PI / 2;
                        }

                    }

                    if (debug_only_one == 0) {
                        // Debug info into the console
                        if (gesture.type != "swipe") return;
                        var j = JSON.stringify(gesture);
                        console.debug(j);
                        if (gesture.state == "stop") {
                            debug_only_one = 1;
                        }
                    }
                });                    
 
                $("#hands").text(frame.hands.length + " hands");
                $("#pointables").text(frame.pointables.length + " pointables");
                $("#rotate_y").text(rotate_y + " rotate_y");

                var x = rotate_y * .02;
                // Move rotate_y towards 0
                if (rotate_y > 0) {
                    rotate_y -= Math.abs(x);
                } else {
                    rotate_y += Math.abs(x);
                }
                cube.rotation.y += x;

                frame.pointables.forEach(function(p,i) {
                    // only act based on one finger
                    if (i > 0) return;
                    $("#x").text(p.tipPosition[0] + " x");
                    $("#y").text(p.tipPosition[1] + " y");
                    $("#z").text(p.tipPosition[2] + " z");
                    if (frame.pointables.length < 3) {
                        $("#pointables").css("color", "#FFF");
                    } else {
                        $("#pointables").css("color", "#F00");
                    }
                });

                renderer.render(scene, camera);
            });



        </script>
    </body>
</html>

